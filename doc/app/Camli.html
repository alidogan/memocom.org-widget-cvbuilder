<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">

<title>class Camli - Rails Application Documentation</title>

<link href="./fonts.css" rel="stylesheet">
<link href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/navigation.js"></script>
<script src="./js/search_index.js"></script>
<script src="./js/search.js"></script>
<script src="./js/searcher.js"></script>
<script src="./js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-add_sha_to_extension_list">#add_sha_to_extension_list</a>
    
    <li ><a href="#method-i-check_auth">#check_auth</a>
    
    <li ><a href="#method-i-does_attr_value_exist-3F">#does_attr_value_exist?</a>
    
    <li ><a href="#method-i-download">#download</a>
    
    <li ><a href="#method-i-get_extensions_for_filter">#get_extensions_for_filter</a>
    
    <li ><a href="#method-i-get_filetype">#get_filetype</a>
    
    <li ><a href="#method-i-get_filetypes_for_filter">#get_filetypes_for_filter</a>
    
    <li ><a href="#method-i-get_last_n_uploads">#get_last_n_uploads</a>
    
    <li ><a href="#method-i-get_permanode_attributes">#get_permanode_attributes</a>
    
    <li ><a href="#method-i-get_sha_from_attr_value">#get_sha_from_attr_value</a>
    
    <li ><a href="#method-i-get_thumbnail">#get_thumbnail</a>
    
    <li ><a href="#method-i-make_file_list">#make_file_list</a>
    
    <li ><a href="#method-i-make_lists">#make_lists</a>
    
    <li ><a href="#method-i-make_sha_list">#make_sha_list</a>
    
    <li ><a href="#method-i-random_string">#random_string</a>
    
    <li ><a href="#method-i-remove_spaces">#remove_spaces</a>
    
    <li ><a href="#method-i-set_attributes">#set_attributes</a>
    
    <li ><a href="#method-i-show_everything">#show_everything</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Camli">
  <h1 id="class-Camli" class="class">
    class Camli
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-download_string" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">download_string</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-filecontent" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">filecontent</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-filename" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">filename</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-filetype" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">filetype</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-metadata" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">metadata</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-permanode" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">permanode</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>If a file is passed to the constructor, the file gets uploaded, and
attributes are set.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 6</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">Http</span><span class="ruby-operator">::</span><span class="ruby-constant">UploadedFile</span>)

                <span class="ruby-identifier">file_params</span> = <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>]

                <span class="ruby-identifier">sha1_collection</span> = <span class="ruby-node">%xcamput file --permanode #{file_params.tempfile.path}`</span>
                <span class="ruby-identifier">sha1_array</span> = <span class="ruby-identifier">sha1_collection</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)

                <span class="ruby-ivar">@permanode</span> = <span class="ruby-identifier">sha1_array</span>[<span class="ruby-value">2</span>]
                <span class="ruby-ivar">@filecontent</span> = <span class="ruby-identifier">sha1_array</span>[<span class="ruby-value">0</span>]

                <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">remove_spaces</span>(<span class="ruby-identifier">file_params</span>.<span class="ruby-identifier">original_filename</span>)
                <span class="ruby-identifier">file_extension</span> = <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;.&#39;</span>)[<span class="ruby-value">1</span>]
                <span class="ruby-identifier">filetype</span> = <span class="ruby-identifier">get_filetype</span>(<span class="ruby-identifier">file_extension</span>)

                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;filename&quot;</span>, <span class="ruby-identifier">filename</span>)
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;file_extension&quot;</span>, <span class="ruby-identifier">file_extension</span>)
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;filetype&quot;</span>, <span class="ruby-identifier">filetype</span>)
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&#39;all_shas&#39;</span>), <span class="ruby-string">&quot;list&quot;</span>, <span class="ruby-ivar">@permanode</span>)
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;auth&quot;</span>, <span class="ruby-identifier">random_string</span>())
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;auth&quot;</span>, <span class="ruby-identifier">random_string</span>())
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;auth&quot;</span>, <span class="ruby-identifier">random_string</span>())
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;public&quot;</span>, <span class="ruby-string">&quot;true&quot;</span>)
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;private&quot;</span>, <span class="ruby-string">&quot;true&quot;</span>)

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">filetype</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;image&quot;</span>
                        <span class="ruby-identifier">get_thumbnail</span>(<span class="ruby-ivar">@permanode</span>)
                <span class="ruby-keyword">end</span>

                <span class="ruby-identifier">add_sha_to_extension_list</span>(<span class="ruby-ivar">@permanode</span>, <span class="ruby-identifier">file_extension</span>)
                <span class="ruby-identifier">add_sha_to_extension_list</span>(<span class="ruby-ivar">@permanode</span>, <span class="ruby-identifier">filetype</span>)

                <span class="ruby-keyword">begin</span>
                        <span class="ruby-identifier">random_string</span> = <span class="ruby-identifier">random_string</span>()
                <span class="ruby-keyword">end</span> <span class="ruby-keyword">while</span> <span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-string">&#39;download&#39;</span>, <span class="ruby-identifier">random_string</span>)

                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;download&quot;</span>, <span class="ruby-identifier">random_string</span>)
                <span class="ruby-identifier">set_attributes</span>(<span class="ruby-string">&quot;icon&quot;</span>, <span class="ruby-node">&quot;96x96/#{filetype}.png&quot;</span>)

        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add_sha_to_extension_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_sha_to_extension_list</span><span
            class="method-args">(sha, file_extension)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Adds permanode to the file_extension list and filetype list. If those lists
don&#39;t exist yet, they are created first.</p>
          
          

          
          <div class="method-source-code" id="add_sha_to_extension_list-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_sha_to_extension_list</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-identifier">file_extension</span>)

        <span class="ruby-identifier">list_exists</span> = <span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-string">&quot;title&quot;</span>, <span class="ruby-identifier">file_extension</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">list_exists</span>
                <span class="ruby-identifier">temp</span> = <span class="ruby-node">%xcamput permanode -title=&quot;#{file_extension}&quot;`</span>
                <span class="ruby-identifier">perm</span> = <span class="ruby-identifier">temp</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)[<span class="ruby-value">0</span>]
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">perm</span> = <span class="ruby-ivar">@result_to_JSON</span>[<span class="ruby-string">&quot;blobs&quot;</span>][<span class="ruby-value">0</span>][<span class="ruby-string">&quot;blob&quot;</span>]
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">perm</span>, <span class="ruby-string">&#39;list&#39;</span>, <span class="ruby-identifier">sha</span>)

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-check_auth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check_auth</span><span
            class="method-args">(sha, auth)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks if the given key is valid</p>
          
          

          
          <div class="method-source-code" id="check_auth-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 416</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check_auth</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-identifier">auth</span>)      

        <span class="ruby-identifier">valid_auth</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;auth&#39;</span>)

        <span class="ruby-identifier">valid_auth</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">auth</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-does_attr_value_exist-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">does_attr_value_exist?</span><span
            class="method-args">(attribute, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks if a permanode exist with an attribute/value pair.</p>
          
          

          
          <div class="method-source-code" id="does_attr_value_exist-3F-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 425</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">value</span>)

        <span class="ruby-identifier">search_result</span> = <span class="ruby-node">%xcamtool search &quot;attr:#{attribute}:#{value}&quot;`</span>

        <span class="ruby-ivar">@result_to_JSON</span> = <span class="ruby-constant">JSON</span>(<span class="ruby-identifier">search_result</span>)

        <span class="ruby-operator">!</span><span class="ruby-ivar">@result_to_JSON</span>[<span class="ruby-string">&quot;blobs&quot;</span>].<span class="ruby-identifier">nil?</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-download" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">download</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns contentSha and filename</p>
          
          

          
          <div class="method-source-code" id="download-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 350</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">download</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-string">&#39;download&#39;</span>, <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">sha1</span> = <span class="ruby-ivar">@result_to_JSON</span>[<span class="ruby-string">&quot;blobs&quot;</span>][<span class="ruby-value">0</span>][<span class="ruby-string">&quot;blob&quot;</span>]

        <span class="ruby-identifier">public_shared</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha1</span>, <span class="ruby-string">&#39;public&#39;</span>)[<span class="ruby-value">0</span>]
        <span class="ruby-identifier">private_shared</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha1</span>, <span class="ruby-string">&#39;private&#39;</span>)[<span class="ruby-value">0</span>]

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&quot;public&quot;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">public_shared</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">private_shared</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;true&quot;</span>
                        <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-ivar">@filecontent</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha1</span>, <span class="ruby-string">&quot;camliContent&quot;</span>)[<span class="ruby-value">0</span>]
        <span class="ruby-ivar">@filename</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha1</span>, <span class="ruby-string">&quot;filename&quot;</span>)[<span class="ruby-value">0</span>]

        <span class="ruby-keyword">return</span> <span class="ruby-ivar">@filecontent</span>, <span class="ruby-ivar">@filename</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_extensions_for_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_extensions_for_filter</span><span
            class="method-args">(filetypes)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Gets all the current extensions</p>
          
          

          
          <div class="method-source-code" id="get_extensions_for_filter-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 257</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_extensions_for_filter</span>(<span class="ruby-identifier">filetypes</span>)

        <span class="ruby-identifier">result</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>

        <span class="ruby-identifier">filetypes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span>

                <span class="ruby-identifier">temp</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&#39;filetypes&#39;</span>), <span class="ruby-identifier">type</span>)
                <span class="ruby-identifier">iter</span> = <span class="ruby-identifier">temp</span>

                <span class="ruby-identifier">iter</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ext</span><span class="ruby-operator">|</span>

                        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-identifier">ext</span>)
                                <span class="ruby-identifier">temp</span> <span class="ruby-operator">-=</span> [<span class="ruby-identifier">ext</span>]
                        <span class="ruby-keyword">end</span>

                <span class="ruby-keyword">end</span>

                <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">temp</span>

        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">result</span>


<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_filetype" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_filetype</span><span
            class="method-args">(file_extension)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks whether the file_extension matches a filetype in the filetypes list.
If the file_extension can&#39;t be matched to a filetype, the returned
value is &#39;unknown&#39;</p>
          
          

          
          <div class="method-source-code" id="get_filetype-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 285</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_filetype</span>(<span class="ruby-identifier">file_extension</span>)

        <span class="ruby-identifier">filetypes</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&#39;filetypes&#39;</span>), <span class="ruby-string">&#39;&#39;</span>)

        <span class="ruby-identifier">filetype</span> = <span class="ruby-string">&quot;unknown&quot;</span>

        <span class="ruby-identifier">filetypes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">file_extension</span>
                        <span class="ruby-identifier">filetype</span> = <span class="ruby-identifier">type</span>[<span class="ruby-value">0</span>]
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">filetype</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_filetypes_for_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_filetypes_for_filter</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Gets all the current filetypes</p>
          
          

          
          <div class="method-source-code" id="get_filetypes_for_filter-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 238</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_filetypes_for_filter</span>()

        <span class="ruby-identifier">filetypes</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>

        <span class="ruby-identifier">result</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&#39;filetypes&#39;</span>), <span class="ruby-string">&#39;&#39;</span>)

        <span class="ruby-identifier">result</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-identifier">type</span>)
                        <span class="ruby-identifier">filetypes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">type</span>
                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">filetypes</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;title&#39;</span>)

        <span class="ruby-identifier">filetypes</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_last_n_uploads" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_last_n_uploads</span><span
            class="method-args">(n)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Used to get the last &#39;n&#39; uploads. This is used for the notification
window.</p>
          
          

          
          <div class="method-source-code" id="get_last_n_uploads-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_last_n_uploads</span>(<span class="ruby-identifier">n</span>)

        <span class="ruby-identifier">all</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&#39;all_shas&#39;</span>), <span class="ruby-string">&#39;list&#39;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">all</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">last_ten</span> = <span class="ruby-identifier">all</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">take</span>(<span class="ruby-identifier">n</span>)
        <span class="ruby-keyword">end</span>


        <span class="ruby-identifier">filenames</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">icons</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>

        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">all</span>.<span class="ruby-identifier">nil?</span>

                <span class="ruby-identifier">last_ten</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sha</span><span class="ruby-operator">|</span>
                        <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;filename&#39;</span>)[<span class="ruby-value">0</span>]

                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">20</span>
                                <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">filename</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">20</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;...&quot;</span>
                        <span class="ruby-keyword">end</span>

                        <span class="ruby-identifier">filenames</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">filename</span>
                        
                        <span class="ruby-identifier">filetype</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;filetype&#39;</span>)[<span class="ruby-value">0</span>]
                        <span class="ruby-identifier">icons</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Icons/32x32/32x32_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filetype</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;.png&quot;</span>
                <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">return</span> <span class="ruby-identifier">filenames</span>, <span class="ruby-identifier">icons</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_permanode_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_permanode_attributes</span><span
            class="method-args">(sha, attr_name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Gets the attribute value that belongs to the sha / attribute_name. If there
is no attr name, every attr gets returned.</p>
          
          

          
          <div class="method-source-code" id="get_permanode_attributes-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 310</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-identifier">attr_name</span>)

        <span class="ruby-identifier">describe</span> = <span class="ruby-node">%xcamtool describe #{sha}`</span>

        <span class="ruby-identifier">describe_to_JSON</span> = <span class="ruby-constant">JSON</span>(<span class="ruby-identifier">describe</span>)

        <span class="ruby-identifier">meta</span> = <span class="ruby-identifier">describe_to_JSON</span>[<span class="ruby-string">&quot;meta&quot;</span>].<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>]

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">attr_name</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&#39;</span>
                <span class="ruby-identifier">describe_to_JSON</span>[<span class="ruby-string">&quot;meta&quot;</span>][<span class="ruby-identifier">meta</span>][<span class="ruby-string">&quot;permanode&quot;</span>][<span class="ruby-string">&quot;attr&quot;</span>]
        <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">describe_to_JSON</span>[<span class="ruby-string">&quot;meta&quot;</span>][<span class="ruby-identifier">meta</span>][<span class="ruby-string">&quot;permanode&quot;</span>][<span class="ruby-string">&quot;attr&quot;</span>][<span class="ruby-identifier">attr_name</span>]
        <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_sha_from_attr_value" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_sha_from_attr_value</span><span
            class="method-args">(attribute, value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Gets the sha which has a match for the attr / value. Currently only returns
most recent permanode´s sha.</p>
          
          

          
          <div class="method-source-code" id="get_sha_from_attr_value-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 405</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">value</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">value</span>)
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-ivar">@result_to_JSON</span>[<span class="ruby-string">&quot;blobs&quot;</span>][<span class="ruby-value">0</span>][<span class="ruby-string">&quot;blob&quot;</span>]

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_thumbnail" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_thumbnail</span><span
            class="method-args">(sha)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Collects thumbnail data and adds it as an attribute to the permanode.
Temporary IP is used so that it always points to the correct location when
the temp IP is replaced by the correct IP.</p>
          
          

          
          <div class="method-source-code" id="get_thumbnail-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 381</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_thumbnail</span>(<span class="ruby-identifier">sha</span>)

        <span class="ruby-identifier">cc</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&quot;camliContent&quot;</span>)[<span class="ruby-value">0</span>]

        <span class="ruby-identifier">cc_description</span> = <span class="ruby-node">%xcamtool describe #{cc}`</span>

        <span class="ruby-identifier">cc_dj</span> = <span class="ruby-constant">JSON</span>(<span class="ruby-identifier">cc_description</span>)

        <span class="ruby-identifier">temp</span> = <span class="ruby-identifier">cc_dj</span>[<span class="ruby-string">&quot;meta&quot;</span>].<span class="ruby-identifier">keys</span>[<span class="ruby-value">0</span>]

        <span class="ruby-identifier">rack</span> = <span class="ruby-identifier">cc_dj</span>[<span class="ruby-string">&quot;meta&quot;</span>][<span class="ruby-identifier">temp</span>][<span class="ruby-string">&quot;file&quot;</span>][<span class="ruby-string">&quot;fileName&quot;</span>]

        <span class="ruby-identifier">ip</span> = <span class="ruby-string">&quot;IP_HERE_TEMP_HJK&quot;</span>

        <span class="ruby-identifier">thumbnail_location</span> = <span class="ruby-string">&quot;http://&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ip</span> <span class="ruby-operator">+</span><span class="ruby-string">&quot;:3179/ui/thumbnail/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cc</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rack</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;?mw=147&amp;tv=2&quot;</span>

        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&quot;thumbnail&quot;</span>, <span class="ruby-identifier">thumbnail_location</span>)

        <span class="ruby-identifier">thumbnail_location</span> = <span class="ruby-string">&quot;http://&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ip</span> <span class="ruby-operator">+</span><span class="ruby-string">&quot;:3179/ui/thumbnail/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">cc</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rack</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;?mw=147&amp;tv=2&quot;</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-make_file_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_file_list</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates the filetype list.</p>
          
          

          
          <div class="method-source-code" id="make_file_list-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_file_list</span>()

        <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> <span class="ruby-string">&quot;I got in make_file_list&quot;</span>

        <span class="ruby-identifier">res</span> = <span class="ruby-value">%xcamput permanode -title=&quot;filetypes&quot;`</span>
        <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)[<span class="ruby-value">0</span>]

        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;audio&#39;</span>, <span class="ruby-string">&#39;mp3&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;audio&#39;</span>, <span class="ruby-string">&#39;wav&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;document&#39;</span>, <span class="ruby-string">&#39;doc&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;document&#39;</span>, <span class="ruby-string">&#39;pdf&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;document&#39;</span>, <span class="ruby-string">&#39;txt&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;document&#39;</span>, <span class="ruby-string">&#39;psd&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;document&#39;</span>, <span class="ruby-string">&#39;docx&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;document&#39;</span>, <span class="ruby-string">&#39;pptx&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;image&#39;</span>,  <span class="ruby-string">&#39;jpg&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;image&#39;</span>,  <span class="ruby-string">&#39;jpeg&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;image&#39;</span>,  <span class="ruby-string">&#39;png&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;image&#39;</span>,  <span class="ruby-string">&#39;gif&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;image&#39;</span>,  <span class="ruby-string">&#39;tif&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;image&#39;</span>,  <span class="ruby-string">&#39;bmp&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;package&#39;</span>,        <span class="ruby-string">&#39;zip&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;package&#39;</span>,        <span class="ruby-string">&#39;rar&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;package&#39;</span>,        <span class="ruby-string">&#39;7z&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;video&#39;</span>,  <span class="ruby-string">&#39;wmv&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;video&#39;</span>,  <span class="ruby-string">&#39;avi&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;video&#39;</span>,  <span class="ruby-string">&#39;mkv&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;video&#39;</span>,  <span class="ruby-string">&#39;mpg&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;video&#39;</span>,  <span class="ruby-string">&#39;mpeg&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;video&#39;</span>,  <span class="ruby-string">&#39;mp4&#39;</span>)
        <span class="ruby-identifier">set_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;video&#39;</span>,  <span class="ruby-string">&#39;mov&#39;</span>)

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-make_lists" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_lists</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks if the filetype and sha lists exist. If not, they make_methods are
called.</p>
          
          

          
          <div class="method-source-code" id="make_lists-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_lists</span>()
        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&#39;filetypes&#39;</span>)
                <span class="ruby-identifier">make_file_list</span>()
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&#39;all_shas&#39;</span>)
                <span class="ruby-identifier">make_sha_list</span>()
        <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-make_sha_list" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_sha_list</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates the sha list.</p>
          
          

          
          <div class="method-source-code" id="make_sha_list-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_sha_list</span>()

        <span class="ruby-value">%xcamput permanode -title=&quot;all_shas&quot;`</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-random_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">random_string</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Generates a random 6 character string</p>
          
          

          
          <div class="method-source-code" id="random_string-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 302</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">random_string</span>()

        (<span class="ruby-value">0</span><span class="ruby-operator">...</span><span class="ruby-value">6</span>).<span class="ruby-identifier">map</span> { (<span class="ruby-string">&#39;a&#39;</span><span class="ruby-operator">..</span><span class="ruby-string">&#39;z&#39;</span>).<span class="ruby-identifier">to_a</span>[<span class="ruby-identifier">rand</span>(<span class="ruby-value">26</span>)] }.<span class="ruby-identifier">join</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-remove_spaces" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_spaces</span><span
            class="method-args">(string)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Removes spaces in a string, and replaces them with _.</p>
          
          

          
          <div class="method-source-code" id="remove_spaces-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 339</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_spaces</span>(<span class="ruby-identifier">string</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39; &#39;</span>
                        <span class="ruby-identifier">string</span> = <span class="ruby-identifier">string</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-string">&#39; &#39;</span>, <span class="ruby-string">&#39;_&#39;</span>)
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">string</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-set_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_attributes</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets an attribute for a certain permanode. If a sha is not added to the
parameters, the current permanode attribute is used.</p>
          
          

          
          <div class="method-source-code" id="set_attributes-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 328</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_attributes</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
                <span class="ruby-node">%xcamput attr --add #{permanode} #{args[0]} #{args[1]}`</span>
        <span class="ruby-keyword">else</span>
                <span class="ruby-node">%xcamput attr --add #{args[0]} #{args[1]} #{args[2]}`</span>
        <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-show_everything" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show_everything</span><span
            class="method-args">(filter)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Gets everything that&#39;s been uploaded to memostore. If there&#39;s a
filter then only the correct filetype/extension will be shown.</p>
          
          

          
          <div class="method-source-code" id="show_everything-source">
            <pre><span class="ruby-comment"># File app/models/camli.rb, line 106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show_everything</span>(<span class="ruby-identifier">filter</span>)

        <span class="ruby-identifier">filenames</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">icons</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">thumbnails</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">links</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
        <span class="ruby-identifier">keys</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>

        
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">all</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&#39;all_shas&#39;</span>), <span class="ruby-string">&#39;list&#39;</span>)
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&quot; &quot;</span>
                <span class="ruby-identifier">array</span> = <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot; &quot;</span>)

                <span class="ruby-identifier">all</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>

                <span class="ruby-identifier">array</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span>

                        <span class="ruby-identifier">sha</span> = <span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-identifier">type</span>)
                        <span class="ruby-keyword">if</span> <span class="ruby-identifier">sha</span>.<span class="ruby-identifier">nil?</span>
                                <span class="ruby-keyword">next</span>
                        <span class="ruby-keyword">end</span>

                        <span class="ruby-identifier">all</span>.<span class="ruby-identifier">concat</span> <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;list&#39;</span>)

                <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">does_attr_value_exist?</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-identifier">filter</span>)
                <span class="ruby-identifier">all</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">get_sha_from_attr_value</span>(<span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-identifier">filter</span>), <span class="ruby-string">&#39;list&#39;</span>)
        <span class="ruby-keyword">else</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">all</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>   

        <span class="ruby-identifier">all</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sha</span><span class="ruby-operator">|</span>
                <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;filename&#39;</span>)[<span class="ruby-value">0</span>]

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">15</span>
                        <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">filename</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">15</span>] <span class="ruby-operator">+</span> <span class="ruby-string">&quot;...&quot;</span>
                <span class="ruby-keyword">end</span>

                <span class="ruby-identifier">filenames</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">filename</span>

                <span class="ruby-identifier">filetype</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;filetype&#39;</span>)[<span class="ruby-value">0</span>]
                <span class="ruby-identifier">icons</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Icons/32x32/32x32_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filetype</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;.png&quot;</span>

                <span class="ruby-identifier">thumbnail</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;thumbnail&#39;</span>)

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">thumbnail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">filetype</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;image&#39;</span>
                        <span class="ruby-identifier">thumbnails</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_thumbnail</span>(<span class="ruby-identifier">sha</span>)
                <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">thumbnail</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">filetype</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;image&#39;</span>
                        <span class="ruby-identifier">thumbnails</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;Icons/96x96/96x96_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">filetype</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;.png&quot;</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">thumbnails</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">thumbnail</span>[<span class="ruby-value">0</span>]  
                <span class="ruby-keyword">end</span>

                <span class="ruby-identifier">links</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;download&#39;</span>)[<span class="ruby-value">0</span>]
                
                <span class="ruby-identifier">auth</span> = <span class="ruby-identifier">get_permanode_attributes</span>(<span class="ruby-identifier">sha</span>, <span class="ruby-string">&#39;auth&#39;</span>)

                <span class="ruby-identifier">keySet</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">auth</span>.<span class="ruby-identifier">nil?</span>
                        <span class="ruby-identifier">keySet</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;&#39;</span>
                <span class="ruby-keyword">else</span>
                        <span class="ruby-identifier">auth</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
                                <span class="ruby-identifier">keySet</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">k</span>
                        <span class="ruby-keyword">end</span>
                <span class="ruby-keyword">end</span>

                <span class="ruby-identifier">keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">keySet</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">return</span> <span class="ruby-identifier">filenames</span>, <span class="ruby-identifier">icons</span>, <span class="ruby-identifier">thumbnails</span>, <span class="ruby-identifier">links</span>, <span class="ruby-identifier">keys</span>

<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

